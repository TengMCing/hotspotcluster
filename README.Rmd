---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
Sys.setlocale("LC_ALL","English")
```

# spotoroo

<!-- badges: start -->
[![R-CMD-check](https://github.com/TengMCing/spotoroo/workflows/R-CMD-check/badge.svg)](https://github.com/TengMCing/spotoroo/actions)
[![Codecov test coverage](https://codecov.io/gh/TengMCing/spotoroo/branch/master/graph/badge.svg)](https://codecov.io/gh/TengMCing/spotoroo?branch=master)
<!-- badges: end -->

spotoroo stands for spatiotemporal clustering in R of hot spot

## Installation

<!-- You can install the released version of spotoroo from [CRAN](https://CRAN.R-project.org) with: -->

<!-- ``` r -->
<!-- install.packages("spotoroo") -->
<!-- ``` -->

You can install the development version from [GitHub](https://github.com/) with:

``` r
install.packages("devtools")
devtools::install_github("TengMCing/spotoroo")
```
## Example

This is a basic example which shows you how to solve a common problem:

```{r echo = FALSE, message=FALSE, warning=FALSE, error=FALSE}
library(devtools)
load_all()
```

```{r}
library(spotoroo)
```


The built-in dataset `hotspots_fin`.

```{r}
str(hotspots_fin)
```

```{r}
hotspots_fin[1:10,]
```

```{r echo = TRUE, warning=FALSE, message=FALSE, error=FALSE, out.width = "70%", out.height="70%"}
library(tidyverse)
plot_vic_map() +
  geom_point(data = hotspots_fin, aes(lon, lat), alpha = 0.3) +
  ggtitle("Raw Hotspots")
```


Perform spatiotemporal clustering on this dataset. You need to provide the data, here it is "hotspots_fin", specify which columns correspond to the spatial variables (lon, lat), and which to time steps (obsTime). There is a choice of options for the algorithm. "activeTime" sets the time to consider that a fire can be active, and longer than this between hotspots will create a new cluster. "adjDist" sets the maximum spatial distance between hotspots beyond which they would be considered part of a different cluster. 

```{r example}
result <- hotspot_cluster(hotspots_fin,
                          lon = "lon",
                          lat = "lat",
                          obsTime = "obsTime",
                          activeTime = 24,
                          adjDist = 3000,
                          minPts = 4,
                          minTime = 3,
                          ignitionCenter = "mean",
                          timeUnit = "h",
                          timeStep = 1)
```

```{r}
result
```


```{r}
summary(result)
```


Extract fires

```{r}
extract_fire(result, 1:2)[1:10,]
```



Plot of the result. In this example, there is a total of 6 clusters, so all can be displayed. 

```{r out.width = "70%", out.height="70%"}
plot(result, bg = vic_map)
```

You can also choose a subset of clusters, and this will plot withou a map, so that you can see a zoomed in view of the hotspot clusters and their ignition points. 

```{r out.width = "70%", out.height="70%"}
plot(result, cluster = c(1,2,3,4))
```

To examine the fire movements, use the option "mov", and the movement will be shown as connected lines between centroids at each time step, for each cluster.  

```{r out.width = "70%", out.height="70%"}
plot(result,
     type = "mov",
     cluster = 1:6,
     step = 3,
     hotspot = TRUE,
     bg = vic_map)
```


To examine the time line of clusters, to learn about intensity of fire periods use the option "timeline".

```{r out.width = "70%", out.height="70%"}
plot(result, "timeline", 
     dateLabel = "%b %d", 
     mainBreak = "1 week")
```

